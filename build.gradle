apply plugin: 'java'
apply plugin: 'idea'
apply plugin: 'eclipse'
apply plugin: 'maven'

version = '0.9.1'

sourceCompatibility = 1.7
targetCompatibility = 1.7

repositories {
    mavenCentral()
    mavenLocal()

    maven {
        name 'conciseset'
        url "http://www.ebi.ac.uk/intact/maven/nexus/content/repositories/ebi-repo/"
    }
}

configurations {
    provided
}

sourceSets {
    main.compileClasspath += configurations.provided
    test.compileClasspath += configurations.provided
    test.runtimeClasspath += configurations.provided
}


dependencies {

    //lucene dependencies
    compile group: 'org.apache.lucene', name: 'lucene-core', version: '4.7.0'
    compile group: 'org.apache.lucene', name: 'lucene-analyzers-common', version: '4.7.0'
    compile('org.apache.lucene:lucene-queryparser:4.7.0') {
        exclude group: 'org.apache.lucene', module: 'lucene-sandbox'
    }

    //additional libraries
    compile group: 'extendedset', name: 'extendedset', version: '2.2'
    compile group: 'net.sourceforge.argo', name: 'argo', version: '3.7'
    compile group: 'commons-collections', name: 'commons-collections', version: '3.2.1'

    provided group: 'com.google.guava', name: 'guava', version: '15.0'

    provided('org.apache.commons:commons-lang3:3.1')

    //provided dependencies
    provided('org.apache.cassandra:cassandra-all:2.0.7') {
        exclude group: 'asm'
        exclude group: 'org.apache.mina'
        exclude group: 'com.google.guava'
    }

    //testing dependencies
    testCompile group: 'junit', name: 'junit', version: '4.11+'

    testCompile('com.datastax.cassandra:cassandra-driver-core:2.0.1') {
        exclude group: 'org.apache.cassandra', module: 'cassandra-all'
        exclude group: 'log4j'
        exclude group: 'io.netty'
        exclude group: 'com.google.guava'
    }

    testCompile('org.cassandraunit:cassandra-unit:2.0.2.0') {
        exclude group: 'org.apache.cassandra', module: 'cassandra-all'
        exclude group: 'log4j'
        exclude group: 'org.sl4j'
        exclude group: 'org.jboss.netty'
        exclude group: 'com.google.guava'
    }

}

test {
    jvmArgs '-javaagent:ext/jamm-0.2.5.jar'
}

task perfTest(type: Test) << {
    jvmArgs '-javaagent:ext/jamm-0.2.5.jar'
    include 'com/tuplejump/perf/**'
}

idea {
    module {
        scopes.PROVIDED.plus += configurations.provided
    }
}

eclipse {
    classpath {
        plusConfigurations += configurations.provided
    }
}

task copyLibs(type: Copy) {
    from configurations.compile
    into 'build/libs'
}

jar { dependsOn copyLibs }

task dist(type:Zip) {
    dependsOn jar
    from ('build/libs/')
    include '*.*'
}

task distTar(type:Tar) {
    dependsOn jar
    from ('build/libs/')
    include '*.*'
}

install {
    repositories.mavenInstaller {
        pom.version = '0.9.1'
        pom.groupId = 'com.tuplejump'
        pom.artifactId = 'stargate-core'
    }
}
